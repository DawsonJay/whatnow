<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatNow - AI Activity Recommendations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .tag-section {
            margin-bottom: 40px;
        }

        .tag-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .tag-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tag {
            padding: 12px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            background: #f8f9fa;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            user-select: none;
        }

        .tag:hover {
            border-color: #667eea;
            background: #f0f2ff;
            transform: translateY(-2px);
        }

        .tag.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .tag.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f8f9fa;
            border-color: #e1e5e9;
        }

        .tag.disabled:hover {
            transform: none;
            border-color: #e1e5e9;
            background: #f8f9fa;
        }

        .selection-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .selection-info h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .selection-info p {
            color: #666;
            margin-bottom: 5px;
        }

        .start-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .start-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .activity-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .activity-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WhatNow</h1>
            <p>AI-powered activity recommendations</p>
        </div>

        <div class="content">
            <div class="tag-section">
                <h3>Weather</h3>
                <div class="tag-group" id="weather-group">
                    <div class="tag" data-tag="sunny">☀️ Sunny</div>
                    <div class="tag" data-tag="cloudy">☁️ Cloudy</div>
                    <div class="tag" data-tag="raining">🌧️ Raining</div>
                    <div class="tag" data-tag="snowy">❄️ Snowy</div>
                    <div class="tag" data-tag="stormy">⛈️ Stormy</div>
                </div>
            </div>

            <div class="tag-section">
                <h3>Time of Day</h3>
                <div class="tag-group" id="time-group">
                    <div class="tag" data-tag="morning">🌅 Morning</div>
                    <div class="tag" data-tag="afternoon">☀️ Afternoon</div>
                    <div class="tag" data-tag="evening">🌆 Evening</div>
                    <div class="tag" data-tag="night">🌙 Night</div>
                </div>
            </div>

            <div class="tag-section">
                <h3>Season</h3>
                <div class="tag-group" id="season-group">
                    <div class="tag" data-tag="spring">🌸 Spring</div>
                    <div class="tag" data-tag="summer">☀️ Summer</div>
                    <div class="tag" data-tag="autumn">🍂 Autumn</div>
                    <div class="tag" data-tag="winter">❄️ Winter</div>
                </div>
            </div>

            <div class="tag-section">
                <h3>Intensity</h3>
                <div class="tag-group" id="intensity-group">
                    <div class="tag" data-tag="chill">😌 Chill</div>
                    <div class="tag" data-tag="tired">😴 Tired</div>
                    <div class="tag" data-tag="exciting">🎉 Exciting</div>
                    <div class="tag" data-tag="energetic">⚡ Energetic</div>
                    <div class="tag" data-tag="intense">🔥 Intense</div>
                </div>
            </div>

            <div class="tag-section">
                <h3>Mood (Select Multiple)</h3>
                <div class="tag-group" id="mood-group">
                    <div class="tag" data-tag="stressed">😰 Stressed</div>
                    <div class="tag" data-tag="motivated">💪 Motivated</div>
                    <div class="tag" data-tag="adventurous">🗺️ Adventurous</div>
                    <div class="tag" data-tag="nostalgic">📸 Nostalgic</div>
                    <div class="tag" data-tag="romantic">💕 Romantic</div>
                    <div class="tag" data-tag="playful">🎮 Playful</div>
                    <div class="tag" data-tag="focused">🎯 Focused</div>
                    <div class="tag" data-tag="distracted">😵 Distracted</div>
                    <div class="tag" data-tag="inspired">💡 Inspired</div>
                    <div class="tag" data-tag="friendly">😊 Friendly</div>
                    <div class="tag" data-tag="shy">😊 Shy</div>
                    <div class="tag" data-tag="curious">🤔 Curious</div>
                    <div class="tag" data-tag="analytical">🔍 Analytical</div>
                    <div class="tag" data-tag="emotional">💝 Emotional</div>
                    <div class="tag" data-tag="burnt_out">🔥 Burnt Out</div>
                    <div class="tag" data-tag="artistic">🎨 Artistic</div>
                    <div class="tag" data-tag="practical">🔧 Practical</div>
                    <div class="tag" data-tag="hungry">🍽️ Hungry</div>
                    <div class="tag" data-tag="natural">🌿 Natural</div>
                    <div class="tag" data-tag="urban">🏙️ Urban</div>
                    <div class="tag" data-tag="anxious">😰 Anxious</div>
                    <div class="tag" data-tag="overwhelmed">😵 Overwhelmed</div>
                    <div class="tag" data-tag="upset">😢 Upset</div>
                    <div class="tag" data-tag="happy">😄 Happy</div>
                    <div class="tag" data-tag="festive">🎊 Festive</div>
                </div>
            </div>

            <div class="selection-info">
                <h4>Selection Rules</h4>
                <p>• Select one tag from each group (Weather, Time, Season, Intensity)</p>
                <p>• Select multiple mood tags (minimum 3, maximum 8)</p>
                <p>• Some tags are mutually exclusive (e.g., "chill" vs "intense")</p>
            </div>

            <button class="start-button" id="start-button" disabled>
                Get AI Recommendations
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>AI is analyzing your preferences...</p>
            </div>

            <div class="results" id="results">
                <h3>Recommended Activities</h3>
                <div id="activities-list"></div>
            </div>
        </div>
    </div>

    <script>
        class TagSelector {
            constructor() {
                this.selectedTags = {
                    weather: null,
                    time: null,
                    season: null,
                    intensity: null,
                    mood: []
                };
                
                this.contradictions = {
                    'chill': ['intense'],
                    'intense': ['chill'],
                    'focused': ['distracted'],
                    'distracted': ['focused'],
                    'natural': ['urban'],
                    'urban': ['natural'],
                    'happy': ['upset'],
                    'upset': ['happy']
                };
                
                this.maxMoodTags = 8;
                this.minMoodTags = 3;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateButtonState();
            }
            
            setupEventListeners() {
                // Weather, Time, Season, Intensity (exclusive selection)
                ['weather', 'time', 'season', 'intensity'].forEach(group => {
                    const groupElement = document.getElementById(`${group}-group`);
                    groupElement.addEventListener('click', (e) => {
                        if (e.target.classList.contains('tag')) {
                            this.selectExclusiveTag(group, e.target);
                        }
                    });
                });
                
                // Mood (multiple selection)
                const moodGroup = document.getElementById('mood-group');
                moodGroup.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tag')) {
                        this.selectMoodTag(e.target);
                    }
                });
                
                // Start button
                document.getElementById('start-button').addEventListener('click', () => {
                    this.startRecommendations();
                });
            }
            
            selectExclusiveTag(group, tagElement) {
                // Clear previous selection in this group
                const groupElement = document.getElementById(`${group}-group`);
                groupElement.querySelectorAll('.tag').forEach(tag => {
                    tag.classList.remove('selected');
                });
                
                // Select new tag
                tagElement.classList.add('selected');
                this.selectedTags[group] = tagElement.dataset.tag;
                
                this.updateContradictions();
                this.updateButtonState();
            }
            
            selectMoodTag(tagElement) {
                const tag = tagElement.dataset.tag;
                
                if (tagElement.classList.contains('selected')) {
                    // Deselect
                    tagElement.classList.remove('selected');
                    this.selectedTags.mood = this.selectedTags.mood.filter(t => t !== tag);
                } else {
                    // Check if we can select more
                    if (this.selectedTags.mood.length >= this.maxMoodTags) {
                        return; // Can't select more
                    }
                    
                    // Check for contradictions
                    if (this.hasContradiction(tag)) {
                        return; // Can't select contradictory tag
                    }
                    
                    // Select
                    tagElement.classList.add('selected');
                    this.selectedTags.mood.push(tag);
                }
                
                this.updateContradictions();
                this.updateButtonState();
            }
            
            hasContradiction(tag) {
                return this.selectedTags.mood.some(selectedTag => {
                    return this.contradictions[tag]?.includes(selectedTag) || 
                           this.contradictions[selectedTag]?.includes(tag);
                });
            }
            
            updateContradictions() {
                const moodGroup = document.getElementById('mood-group');
                moodGroup.querySelectorAll('.tag').forEach(tagElement => {
                    const tag = tagElement.dataset.tag;
                    
                    if (tagElement.classList.contains('selected')) {
                        tagElement.classList.remove('disabled');
                    } else if (this.hasContradiction(tag)) {
                        tagElement.classList.add('disabled');
                    } else if (this.selectedTags.mood.length >= this.maxMoodTags) {
                        tagElement.classList.add('disabled');
                    } else {
                        tagElement.classList.remove('disabled');
                    }
                });
            }
            
            updateButtonState() {
                const button = document.getElementById('start-button');
                const hasRequiredSelections = this.selectedTags.weather && 
                                            this.selectedTags.time && 
                                            this.selectedTags.season && 
                                            this.selectedTags.intensity;
                const hasEnoughMoodTags = this.selectedTags.mood.length >= this.minMoodTags;
                
                button.disabled = !(hasRequiredSelections && hasEnoughMoodTags);
            }
            
            async startRecommendations() {
                const button = document.getElementById('start-button');
                const loading = document.getElementById('loading');
                const results = document.getElementById('results');
                
                button.disabled = true;
                loading.style.display = 'block';
                results.style.display = 'none';
                
                try {
                    const contextTags = [
                        this.selectedTags.weather,
                        this.selectedTags.time,
                        this.selectedTags.season,
                        this.selectedTags.intensity,
                        ...this.selectedTags.mood
                    ];
                    
                    const response = await fetch('/activities/game/start', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(contextTags)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    this.displayResults(data);
                    
                } catch (error) {
                    console.error('Error getting recommendations:', error);
                    alert('Failed to get recommendations. Please try again.');
                } finally {
                    button.disabled = false;
                    loading.style.display = 'none';
                }
            }
            
            displayResults(data) {
                const results = document.getElementById('results');
                const activitiesList = document.getElementById('activities-list');
                
                activitiesList.innerHTML = '';
                
                data.recommendations.forEach(activity => {
                    const activityCard = document.createElement('div');
                    activityCard.className = 'activity-card';
                    activityCard.innerHTML = `
                        <div class="activity-name">${activity.name}</div>
                        <div class="activity-description">AI recommended based on your preferences</div>
                    `;
                    activitiesList.appendChild(activityCard);
                });
                
                results.style.display = 'block';
            }
        }
        
        // Initialize the tag selector when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new TagSelector();
        });
    </script>
</body>
</html>
